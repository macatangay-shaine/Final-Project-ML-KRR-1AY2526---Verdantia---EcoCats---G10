<!DOCTYPE html>
<html>
<head>
    <title>Verdantia - Plant Health Advisor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css', v='20251222') }}">
    <script>
        function setDefault(field, value) {
            const el = document.getElementsByName(field)[0];
            if (el) el.value = value;
        }
        function setAllDefaults() {
            setDefault('n', 50);
            setDefault('p', 50);
            setDefault('k', 50);
            setDefault('ph', 6.5);
            setDefault('temperature', 25);
            setDefault('humidity', 70);
            setDefault('rainfall', 150);
        }
    </script>
</head>
<body class="show-navbar">

{% include "partials/navbar.html" %}
{% include "partials/sidebar.html" %}

<main class="page-content">
    <div class="app">
        <section class="screen form-screen">
        <div class="unified-form-card">
            <div class="form-header">
                <a class="back-btn" href="{{ url_for('mode_select') }}">â€¹</a>
                <div class="form-title">Plant Health Advisor</div>
                
            </div>
            <div class="form-results-grid">
            <div class="form-panel">
                <form method="POST" action="{{ url_for('advisor') }}">
                    <input type="hidden" name="profile_username" value="{{ session.get('profile_username','') }}" />
                    <input type="hidden" name="profile_avatar" value="{{ session.get('profile_avatar','') }}" />
                    <div class="input-group">
                        <div class="label-row">
                            <label for="current_plant">Current Plant (for diagnosis)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-plant">â–¼</button>
                        </div>
                        <div id="help-plant" class="field-help">Optional. If provided, diagnosis is contextualized for this plant.</div>
                        <input id="current_plant" type="text" name="current_plant" placeholder="e.g., tomato, lettuce, rice">
                    </div>

                    <h3>Environmental Conditions</h3>

                    <div class="input-group">
                        <div class="label-row">
                            <label for="n">Nitrogen (N)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-n">â–¼</button>
                        </div>
                        <div id="help-n" class="field-help">
                            <strong>Nitrogen:</strong> Essential for vegetative growth and chlorophyll. Typical range: 0â€“140.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('n', 50)">Use Typical (50)</button>
                            <div class="hint-text">No soil kit? Start with 50 and adjust based on leaf color and vigor.</div></div>
                        </div>
                        <input id="n" type="number" step="any" name="n" required placeholder="e.g., 50">
                    </div>

                    <div class="input-group">
                        <div class="label-row">
                            <label for="p">Phosphorus (P)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-p">â–¼</button>
                        </div>
                        <div id="help-p" class="field-help">
                            <strong>Phosphorus:</strong> Supports root development and flowering. Typical range: 5â€“145.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('p', 50)">Use Typical (50)</button>
                            <div class="hint-text">Without testing, use 50; watch for poor rooting or delayed flowering.</div></div>
                        </div>
                        <input id="p" type="number" step="any" name="p" required placeholder="e.g., 50">
                    </div>

                    <div class="input-group">
                        <div class="label-row">
                            <label for="k">Potassium (K)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-k">â–¼</button>
                        </div>
                        <div id="help-k" class="field-help">
                            <strong>Potassium:</strong> Improves vigor and disease resistance. Typical range: 5â€“205.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('k', 50)">Use Typical (50)</button>
                            <div class="hint-text">If unsure, start at 50; adjust if plants look weak or disease-prone.</div></div>
                        </div>
                        <input id="k" type="number" step="any" name="k" required placeholder="e.g., 50">
                    </div>

                    <div class="input-group">
                        <div class="label-row">
                            <label for="ph">pH Level</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-ph">â–¼</button>
                        </div>
                        <div id="help-ph" class="field-help">
                            <strong>Soil pH:</strong> Controls nutrient availability. Most plants: 6.0â€“7.0; acid-loving: 4.5â€“5.5.
                            <div class="hint-text">No pH meter? Start with 6.5 (neutral) and adjust later.</div>
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('ph', 6.5)">Use Neutral (6.5)</button></div>
                        </div>
                        <input id="ph" type="number" step="any" name="ph" required min="0" max="14" placeholder="e.g., 6.5">
                    </div>

                    <div class="input-group">
                        <div class="label-row">
                            <label for="temperature">Temperature (Â°C)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-temp">â–¼</button>
                        </div>
                        <div id="help-temp" class="field-help">Average daily temperature. Typical range: 8â€“45Â°C.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('temperature', 25)">Use Typical (25Â°C)</button></div>
                        </div>
                        <input id="temperature" type="number" step="any" name="temperature" required placeholder="e.g., 25">
                    </div>

                    <div class="input-group">
                        <div class="label-row">
                            <label for="humidity">Humidity (%)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-humidity">â–¼</button>
                        </div>
                        <div id="help-humidity" class="field-help">Air moisture percentage. Coastal 70â€“90%, dry 30â€“50%.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('humidity', 70)">Use Typical (70%)</button></div>
                        </div>
                        <input id="humidity" type="number" step="any" name="humidity" required min="0" max="100" placeholder="e.g., 70">
                    </div>

                    <div class="input-group">
                        <div class="label-row">
                            <label for="rainfall">Rainfall (mm)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-rainfall">â–¼</button>
                        </div>
                        <div id="help-rainfall" class="field-help">Average monthly precipitation. Light: 50â€“100 mm; Moderate: 100â€“200 mm; Heavy: 200+ mm.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('rainfall', 150)">Use Typical (150 mm)</button></div>
                        </div>
                        <input id="rainfall" type="number" step="any" name="rainfall" required placeholder="e.g., 150">
                    </div>

                    <div class="input-group">
                        <div class="label-row">
                            <label for="soil_type">Soil Type</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-soil">â–¼</button>
                        </div>
                        <div id="help-soil" class="field-help">
                            <strong>Clay:</strong> Heavy, sticky, water-retentive. <strong>Loam:</strong> Balanced, ideal. <strong>Sandy:</strong> Light, fast-draining.
                        </div>
                        <select id="soil_type" name="soil_type"><option>Clay</option><option>Loam</option><option>Sandy</option></select>
                    </div>

                    <div class="input-group">
                        <div class="label-row">
                            <label for="climate">Climate Type</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-climate">â–¼</button>
                        </div>
                        <div id="help-climate" class="field-help">Tropical Wet: rainy year-round. Tropical Moist: wet/dry seasons. Tropical Dry: long dry spells. Urban Heat Zone: warmer urban microclimate.</div>
                        <select id="climate" name="climate"><option>Tropical Wet</option><option>Tropical Moist</option><option>Tropical Dry</option><option>Urban Heat Zone</option></select>
                    </div>

                    <div class="default-all-section">
                        <p><strong>Donâ€™t have testing equipment?</strong></p>
                        <button type="button" class="default-all-btn" onclick="setAllDefaults()">Fill with Typical Values</button>
                        <p class="hint-text">Start with typical tropical values, then adjust based on plant response.</p>
                    </div>
                    <button type="submit" class="analyze-btn">Analyze</button>
                </form>
            </div>
            <div class="results-panel">
                {% if error %}
                <div class="error"><h2>Error</h2><p>{{ error }}</p></div>
                {% endif %}
                {% if result %}
                <div class="result card">
                    <h2>Results</h2>
                    <section class="primary-result">
                        <h3 class="section-title">Diagnosis</h3>
                        <p class="primary-value">{{ result.condition }}</p>
                        <p class="secondary-value">Plant: {{ result.plant }}</p>
                    </section>
                    <section class="analysis-block">
                        <h4>Explanation</h4>
                        <p>{{ result.reason }}</p>
                        <h4 style="margin-top:12px;">Advice</h4>
                        <p>{{ result.advice }}</p>
                    </section>
                    <details class="details">
                        <summary>Environmental Inputs</summary>
                        <ul>
                            <li>Nitrogen: {{ result.inputs.n }}</li>
                            <li>Phosphorus: {{ result.inputs.p }}</li>
                            <li>Potassium: {{ result.inputs.k }}</li>
                            <li>Temperature: {{ result.inputs.temperature }}Â°C</li>
                            <li>Humidity: {{ result.inputs.humidity }}%</li>
                            <li>Rainfall: {{ result.inputs.rainfall }}mm</li>
                            <li>Soil Type: {{ result.inputs.soil_type }}</li>
                            <li>Climate: {{ result.inputs.climate }}</li>
                        </ul>
                    </details>
                </div>
                {% endif %}
                {% if not result and not error %}
                <div class="empty-state">
                    <div class="empty-icon">ðŸ§ª</div>
                    <h2>Diagnosis Results</h2>
                    <p>Fill the form and click <strong>Analyze</strong>. Your diagnosis and advice will appear here.</p>
                </div>
                {% endif %}
            </div>
            </div>
        </div>
    </section>
    </div>
</main>
<script src="{{ url_for('static', filename='js/ui.js') }}"></script>
</body>
</html>
