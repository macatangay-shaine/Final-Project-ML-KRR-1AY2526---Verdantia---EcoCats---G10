<!DOCTYPE html>
<html>
<head>
    <title>Verdantia - Plant Recommendation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css', v='20251222') }}">
    <script>
        function setDefault(field, value) {
            const el = document.getElementsByName(field)[0];
            if (el) el.value = value;
        }
        function setAllDefaults() {
            setDefault('n', 50);
            setDefault('p', 50);
            setDefault('k', 50);
            setDefault('ph', 6.5);
            setDefault('temperature', 25);
            setDefault('humidity', 70);
            setDefault('rainfall', 150);
        }
    </script>
    
</head>
<body class="show-navbar">

{% include "partials/navbar.html" %}
{% include "partials/sidebar.html" %}

<main class="page-content">
    <div class="app">
        <section class="screen form-screen">
        <div class="unified-form-card">
            <div class="form-header">
                <a class="back-btn" href="{{ url_for('mode_select') }}">‚Äπ</a>
                <div class="form-title">Plant Recommendation</div>
                
            </div>
            <div class="form-results-grid">
            <div class="form-panel">
                <form method="POST" action="{{ url_for('recommend') }}">
                    <input type="hidden" name="profile_username" value="{{ session.get('profile_username','') }}" />
                    <input type="hidden" name="profile_avatar" value="{{ session.get('profile_avatar','') }}" />
                    <h3>Environmental Conditions</h3>
                    <div class="input-group">
                        <div class="label-row">
                            <label for="n">Nitrogen (N)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-n">‚ñº</button>
                        </div>
                        <div id="help-n" class="field-help">
                            <strong>Nitrogen:</strong> Essential for vegetative growth and chlorophyll. Typical range: 0‚Äì140.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('n', 50)">Use Typical (50)</button></div>
                        </div>
                        <input id="n" type="number" step="any" name="n" required placeholder="e.g., 90">
                    </div>
                    <div class="input-group">
                        <div class="label-row">
                            <label for="p">Phosphorus (P)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-p">‚ñº</button>
                        </div>
                        <div id="help-p" class="field-help">
                            <strong>Phosphorus:</strong> Supports root development and flowering. Typical range: 5‚Äì145.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('p', 50)">Use Typical (50)</button></div>
                        </div>
                        <input id="p" type="number" step="any" name="p" required placeholder="e.g., 42">
                    </div>
                    <div class="input-group">
                        <div class="label-row">
                            <label for="k">Potassium (K)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-k">‚ñº</button>
                        </div>
                        <div id="help-k" class="field-help">
                            <strong>Potassium:</strong> Improves vigor and disease resistance. Typical range: 5‚Äì205.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('k', 50)">Use Typical (50)</button></div>
                        </div>
                        <input id="k" type="number" step="any" name="k" required placeholder="e.g., 43">
                    </div>
                    <div class="input-group">
                        <div class="label-row">
                            <label for="ph">pH Level</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-ph">‚ñº</button>
                        </div>
                        <div id="help-ph" class="field-help">
                            <strong>Soil pH:</strong> Controls nutrient availability. Typical ranges: most plants 6.0‚Äì7.0; acid-loving 4.5‚Äì5.5.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('ph', 6.5)">Use Neutral (6.5)</button></div>
                        </div>
                        <input id="ph" type="number" step="any" name="ph" required placeholder="e.g., 6.5" min="0" max="14">
                    </div>
                    <div class="input-group">
                        <div class="label-row">
                            <label for="temperature">Temperature (¬∞C)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-temp">‚ñº</button>
                        </div>
                        <div id="help-temp" class="field-help">
                            Average daily temperature. Typical range: 8‚Äì45¬∞C.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('temperature', 25)">Use Typical (25¬∞C)</button></div>
                        </div>
                        <input id="temperature" type="number" step="any" name="temperature" required placeholder="e.g., 25">
                    </div>
                    <div class="input-group">
                        <div class="label-row">
                            <label for="humidity">Humidity (%)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-humidity">‚ñº</button>
                        </div>
                        <div id="help-humidity" class="field-help">
                            Air moisture percentage. Typical: coastal 70‚Äì90%, dry 30‚Äì50%.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('humidity', 70)">Use Typical (70%)</button></div>
                        </div>
                        <input id="humidity" type="number" step="any" name="humidity" required placeholder="e.g., 80" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <div class="label-row">
                            <label for="rainfall">Rainfall (mm)</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-rainfall">‚ñº</button>
                        </div>
                        <div id="help-rainfall" class="field-help">
                            Average monthly precipitation. Light: 50‚Äì100 mm; Moderate: 100‚Äì200 mm; Heavy: 200+ mm.
                            <div style="margin-top:8px;"><button type="button" class="default-btn" onclick="setDefault('rainfall', 150)">Use Typical (150 mm)</button></div>
                        </div>
                        <input id="rainfall" type="number" step="any" name="rainfall" required placeholder="e.g., 200">
                    </div>
                    <div class="input-group">
                        <div class="label-row">
                            <label for="soil_type">Soil Type</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-soil">‚ñº</button>
                        </div>
                        <div id="help-soil" class="field-help">
                            <strong>Clay:</strong> Heavy, sticky when wet, retains water.<br>
                            <strong>Loam:</strong> Balanced mix of sand/silt/clay; ideal for most crops.<br>
                            <strong>Sandy:</strong> Light, fast-draining, low retention.
                        </div>
                        <select name="soil_type" id="soil_type">
                            <option value="Clay">Clay (Heavy, water-retaining)</option>
                            <option value="Loam">Loam (Balanced, ideal)</option>
                            <option value="Sandy">Sandy (Light, fast-draining)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <div class="label-row">
                            <label for="climate">Climate Type</label>
                            <button type="button" class="info-toggle" aria-expanded="false" aria-controls="help-climate">‚ñº</button>
                        </div>
                        <div id="help-climate" class="field-help">
                            Tropical Wet: rainy year-round. Tropical Moist: distinct wet/dry seasons. Tropical Dry: long dry spells. Urban Heat Zone: warmer microclimate in cities.
                        </div>
                        <select id="climate" name="climate">
                            <option value="Tropical Wet">Tropical Wet (Rainy year-round)</option>
                            <option value="Tropical Moist">Tropical Moist (Seasonal rain)</option>
                            <option value="Tropical Dry">Tropical Dry (Long dry spells)</option>
                            <option value="Urban Heat Zone">Urban Heat Zone (City heat)</option>
                        </select>
                    </div>

                    <div class="default-all-section">
                        <p><strong>Don‚Äôt have testing equipment?</strong></p>
                        <button type="button" class="default-all-btn" onclick="setAllDefaults()">Fill with Typical Values</button>
                        <p class="hint-text">Use typical values for tropical gardening, then adjust based on your observations</p>
                    </div>

                    <button type="submit" class="analyze-btn">Analyze</button>
                </form>
            </div>
            <div class="results-panel">
                {% if error %}
                <div class="error">
                    <h2>‚ö†Ô∏è Error</h2>
                    <p>{{ error }}</p>
                </div>
                {% endif %}
                {% if result %}
                <div class="result card">
                    <h2>Results</h2>
                    <section class="primary-result">
                        <h3 class="section-title">Recommended Crop</h3>
                        <p class="primary-value">{{ result.crop }}</p>
                    </section>
                    {% if result.alternatives and result.alternatives|length > 0 %}
                    <section class="analysis-block">
                        <h4>Additional Suitable Crops</h4>
                        <p>Other crops with a strong match to your conditions:</p>
                        <ul class="recommendation-reasons">
                            {% for alt in result.alternatives %}
                            <li>
                                <strong>{{ alt.crop }}</strong>
                                {% if alt.suitability is defined %}
                                    <span class="alt-confidence">‚Äî suitability {{ alt.suitability }}%</span>
                                {% endif %}
                            </li>
                            {% endfor %}
                        </ul>
                    </section>
                    {% endif %}
                    <section class="analysis-block">
                        <h4>Explanation</h4>
                        <p>{{ result.message }}</p>
                        <hr class="divider" />
                        <ul class="recommendation-reasons">
                            <li><strong>Soil compatibility:</strong> {{ result.crop }} performs well in {{ result.inputs.soil_type|lower }} soils.</li>
                            <li><strong>Climate match:</strong> Suited to {{ result.inputs.climate|lower }} conditions.</li>
                            <li><strong>Temperature:</strong> Works with {{ result.inputs.temperature }}¬∞C average.</li>
                            <li><strong>Moisture:</strong> Aligns with {{ result.inputs.humidity }}% humidity and {{ result.inputs.rainfall }} mm rainfall.</li>
                        </ul>
                    </section>

                    <details class="details" open>
                        <summary>Complete Environmental Analysis</summary>
                        <div class="environmental-grid">
                            <div class="env-section">
                                <h4>Soil Nutrients</h4>
                                <ul>
                                    <li>Nitrogen (N): {{ result.inputs.n }} <span class="{% if result.inputs.n|float >= 40 and result.inputs.n|float <= 60 %}status-good{% elif result.inputs.n|float < 40 %}status-low{% else %}status-high{% endif %}">{% if result.inputs.n|float >= 40 and result.inputs.n|float <= 60 %}OPTIMAL{% elif result.inputs.n|float < 40 %}LOW{% else %}HIGH{% endif %}</span></li>
                                    <li>Phosphorus (P): {{ result.inputs.p }} <span class="{% if result.inputs.p|float >= 25 and result.inputs.p|float <= 75 %}status-good{% elif result.inputs.p|float < 25 %}status-low{% else %}status-high{% endif %}">{% if result.inputs.p|float >= 25 and result.inputs.p|float <= 75 %}OPTIMAL{% elif result.inputs.p|float < 25 %}LOW{% else %}HIGH{% endif %}</span></li>
                                    <li>Potassium (K): {{ result.inputs.k }} <span class="{% if result.inputs.k|float >= 30 and result.inputs.k|float <= 70 %}status-good{% elif result.inputs.k|float < 30 %}status-low{% else %}status-high{% endif %}">{% if result.inputs.k|float >= 30 and result.inputs.k|float <= 70 %}OPTIMAL{% elif result.inputs.k|float < 30 %}LOW{% else %}HIGH{% endif %}</span></li>
                                    <li>pH Level: {{ result.inputs.ph }} <span class="{% if result.inputs.ph|float >= 6.0 and result.inputs.ph|float <= 7.5 %}status-good{% elif result.inputs.ph|float < 6.0 %}status-low{% else %}status-high{% endif %}">{% if result.inputs.ph|float >= 6.0 and result.inputs.ph|float <= 7.5 %}OPTIMAL{% elif result.inputs.ph|float < 6.0 %}ACIDIC{% else %}ALKALINE{% endif %}</span></li>
                                </ul>
                            </div>
                            <div class="env-section">
                                <h4>Climate Conditions</h4>
                                <ul>
                                    <li>Temperature: {{ result.inputs.temperature }}¬∞C <span class="{% if result.inputs.temperature|float >= 20 and result.inputs.temperature|float <= 30 %}status-good{% elif result.inputs.temperature|float < 20 %}status-low{% else %}status-high{% endif %}">{% if result.inputs.temperature|float >= 20 and result.inputs.temperature|float <= 30 %}OPTIMAL{% elif result.inputs.temperature|float < 20 %}COOL{% else %}HOT{% endif %}</span></li>
                                    <li>Humidity: {{ result.inputs.humidity }}% <span class="{% if result.inputs.humidity|float >= 50 and result.inputs.humidity|float <= 80 %}status-good{% elif result.inputs.humidity|float < 50 %}status-low{% else %}status-high{% endif %}">{% if result.inputs.humidity|float >= 50 and result.inputs.humidity|float <= 80 %}OPTIMAL{% elif result.inputs.humidity|float < 50 %}DRY{% else %}HUMID{% endif %}</span></li>
                                    <li>Rainfall: {{ result.inputs.rainfall }}mm <span class="{% if result.inputs.rainfall|float >= 100 and result.inputs.rainfall|float <= 200 %}status-good{% elif result.inputs.rainfall|float < 100 %}status-low{% else %}status-high{% endif %}">{% if result.inputs.rainfall|float >= 100 and result.inputs.rainfall|float <= 200 %}OPTIMAL{% elif result.inputs.rainfall|float < 100 %}LOW{% else %}HIGH{% endif %}</span></li>
                                    <li>Climate: {{ result.inputs.climate }} <span class="status-good">MATCHED</span></li>
                                </ul>
                            </div>
                        </div>
                    </details>

                    <div class="care-tips analysis-block">
                        <h4>Growing Tips for {{ result.crop }}</h4>
                        <ul class="recommendation-reasons">
                            {% for tip in result.tips %}
                            <li>{{ tip }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}
                {% if not result and not error %}
                <div class="empty-state">
                    <div class="empty-icon">üß™</div>
                    <h2>Analysis Results</h2>
                    <p>Fill the form and click <strong>Analyze</strong>. Your recommended crop and reasoning will appear here.</p>
                </div>
                {% endif %}
            </div>
            </div>
        </div>
    </section>
    </div>
</main>
<script src="{{ url_for('static', filename='js/ui.js') }}"></script>
</body>
</html>
